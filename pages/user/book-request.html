<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Book Request Form</title>
    <link rel="stylesheet" href="../../assets/css/main_page.css" />
    <link rel="stylesheet" href="../../assets/css/book-request.css" />
    <link
      rel="icon"
      href="../../assets/images/book-half.svg"
      type="image/x-icon"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment-with-locales.min.js"
      integrity="sha512-42PE0rd+wZ2hNXftlM78BSehIGzezNeQuzihiBCvUEB3CVxHvsShF86wBWwQORNxNINlBPuq7rG4WWhNiTVHFg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script src="../../assets/js/db.js"></script>
    <script src="../../assets/js/user/script.js"></script>
    <script src="../../assets/js/user/header.js" defer></script>
    <script src="../../assets/js/user/sidebar.js" defer></script>
  </head>
  <body>
    <nav class="sidebar" id="sidebar">
      <div class="side-header">
        <div class="logo">
          <i class="bi bi-book-half"></i>
          <p>Bookly</p>
        </div>
        <div class="divider-line"></div>
        <div class="nav-list">
          <a href="./homepage.html" class="nav-items"
            ><i class="bi bi-house"></i>
            <p>Home</p>
            <div class="tooltip" role="tooltip" data-popper-placement="right">
              Home
              <div class="arrow" data-popper-arrow></div>
            </div>
          </a>
          <a href="../library.html" class="nav-items"
            ><i class="bi bi-building"></i>
            <p>Library</p>
            <div
              class="tooltip"
              role="tooltip"
              style="top: 195px"
              data-popper-placement="right"
            >
              Library
              <div class="arrow" data-popper-arrow></div>
            </div>
          </a>
          <a href="./history.html" class="nav-items"
            ><i class="bi bi-hourglass"></i>
            <p>History</p>
            <div
              class="tooltip"
              role="tooltip"
              style="top: 255px"
              data-popper-placement="right"
            >
              History
              <div class="arrow" data-popper-arrow></div>
            </div>
          </a>
          <a href="./favourites.html" class="nav-items"
            ><i class="bi bi-bookmark-heart"></i>
            <p>Favourites</p>
            <div
              class="tooltip"
              role="tooltip"
              style="top: 315px"
              data-popper-placement="right"
            >
              Favourites
              <div class="arrow" data-popper-arrow></div>
            </div>
          </a>
          <a href="#" class="nav-items active"
            ><i class="bi bi-file-earmark-text-fill"></i>
            <p>Request Book</p>
            <div
              class="tooltip"
              role="tooltip"
              style="top: 370px"
              data-popper-placement="right"
            >
              Request Book
              <div class="arrow" data-popper-arrow></div>
            </div>
          </a>
        </div>
      </div>
      <div class="side-footer">
        <div class="dark-toggle">
          <a href="#" onclick="darkMode()" class="nav-items"
            ><i class="bi bi-moon-stars-fill dark-light"></i>
            <p class="da-li-text">Dark mode</p>
            <div
              class="tooltip"
              role="tooltip"
              style="bottom: 115px; top: unset"
              data-popper-placement="right"
            >
              Theme
              <div class="arrow" data-popper-arrow></div>
            </div>
          </a>
          <a href="#" class="nav-items" id="sign-out"
            ><i class="bi bi-box-arrow-left"></i>
            <p>Log Out</p>
            <div
              class="tooltip"
              role="tooltip"
              style="bottom: 55px; top: unset"
              data-popper-placement="right"
            >
              Log-Out
              <div class="arrow" data-popper-arrow></div>
            </div>
          </a>
        </div>
      </div>
    </nav>

    <section class="main-container">
      <main class="request-section">
        <form action="" class="book-request">
          <div class="form-title">
            <h2>Request a Book</h2>
          </div>
          <div class="input-group">
            <label for="book-name">Book-name : <sup>*</sup></label>
            <div class="input-field">
              <input
                type="book-name"
                name="book-name"
                id="book-name"
                placeholder="Enter the book-name"
                class="input"
                required
              />
            </div>
          </div>
          <div class="input-group">
            <label for="author-name">Author-name :<sup>*</sup> </label>
            <div class="input-field">
              <input
                type="author-name"
                name="author-name"
                id="author-name"
                placeholder="Enter the author-name"
                class="input"
                required
              />
            </div>
          </div>
          <div class="input-group">
            <label for="source-link"
              >Source Link :<sup style="color: var(--font-black)"
                >(optional)</sup
              ></label
            >
            <div class="input-field">
              <input
                type="url"
                name="source-link"
                id="source-link"
                placeholder="Enter the source-link"
                class="input"
                maxlength="4"
              />
            </div>
          </div>
          <div class="input-group">
            <label for="description">Why this Book? :<sup>*</sup></label>
            <div class="input-field">
              <textarea
                name="description"
                id="description"
                maxlength="300"
                placeholder="Give us a small description why this book is needed for our library (Max Characters : 300)"
              >
The Marvel Book is an exhilarating journey through the endlessly fascinating, ever-dynamic, and awe-inspiring Marvel Comics universe. One Marvel book to guide them all.If you want to understand the Marvel Comics Universe in all its complex glory, The Marvel Book is the only book you need. It is a unique exploration of the vast, interconnected Marvel Comics Multiverse from its birth to the end of everything and beyond.</textarea
              >
            </div>
          </div>
          <div class="input-group">
            <button class="submit">Submit</button>
          </div>
        </form>
      </main>
    </section>

    <script type="module">
      // Select the form and input fields
      const bookReqForm = document.querySelector(".book-request");
      const bookName = document.getElementById("book-name");
      const authorName = document.getElementById("author-name");
      const bookSrcLink = document.getElementById("source-link");
      const bookDesc = document.getElementById("description");

      // Add event listener to the form
      bookReqForm.addEventListener("submit", async function (e) {
        e.preventDefault();
        try {
          // Check if the book is already requested
          const bookReqArr = await getData("BookRequests");
          const bookExists = bookReqArr.some(
            (book) => book.book_name === bookName.value.toLowerCase()
          );
          if (bookExists) {
            throw new Error("The book is already requested");
          }
          const reqId = generateGuid();
          // Create a new book request object
          const bookReqObj = {
            book_name: bookName.value.toLowerCase(),
            author_name: authorName.value,
            source_link: bookSrcLink.value,
            description: bookDesc.value,
            user_id: thisUser.id,
            log: moment(),
            id: reqId,
          };
          setLoader(true);
          // Add the new book request to the array in local storage
          putData(`BookRequests/${reqId}`, bookReqObj).then(() => {
            alert("Book requested successfully");
            bookReqForm.reset();
            location.reload();
            setLoader(false);
          });
        } catch (error) {
          alert(`Error requesting book: ${error.message}`);
        }
      });
      setLoader(false);
    </script>
  </body>
</html>
