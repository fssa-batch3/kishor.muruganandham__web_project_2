<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Book Request List</title>
    <link
      rel="icon"
      href="../../assets/images/book-half.svg"
      type="image/x-icon"
    />
    <link rel="stylesheet" href="../../assets/css/main_page.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment-with-locales.min.js"
      integrity="sha512-42PE0rd+wZ2hNXftlM78BSehIGzezNeQuzihiBCvUEB3CVxHvsShF86wBWwQORNxNINlBPuq7rG4WWhNiTVHFg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script src="../../assets/js/db.js"></script>
    <script src="../../assets/js/user/script.js"></script>
    <script src="../../assets/js/user/header.js" defer></script>
    <script src="../../assets/js/user/sidebar.js" defer></script>
  </head>
  <body>
    <nav class="sidebar" id="sidebar">
      <div class="side-header">
        <div class="logo">
          <i class="bi bi-book-half"></i>
          <p>Bookly</p>
        </div>
        <div class="divider-line"></div>
        <div class="nav-list">
          <a href="./admin-dashboard.html" class="nav-items"
            ><i class="bi bi-grid"></i>
            <p>Dashboard</p>
            <div class="tooltip" role="tooltip" data-popper-placement="right">
              Dashboard
              <div class="arrow" data-popper-arrow></div>
            </div>
          </a>
          <a href="./admin_library.html" class="nav-items"
            ><i class="bi bi-building"></i>
            <p>Library</p>
            <div
              class="tooltip"
              role="tooltip"
              style="top: 195px"
              data-popper-placement="right"
            >
              Library
              <div class="arrow" data-popper-arrow></div>
            </div>
          </a>
          <a href="./borrow-list.html" class="nav-items"
            ><i class="bi bi-inboxes"></i>
            <p>Borrow List</p>
            <div
              class="tooltip"
              role="tooltip"
              style="top: 255px"
              data-popper-placement="right"
            >
              Borrow List
              <div class="arrow" data-popper-arrow></div>
            </div>
          </a>
          <a href="./admin_create-book.html" class="nav-items"
            ><i class="bi bi-file-plus"></i>
            <p>Create Book</p>
            <div
              class="tooltip"
              role="tooltip"
              style="top: 315px"
              data-popper-placement="right"
            >
              Create Book
              <div class="arrow" data-popper-arrow></div>
            </div>
          </a>
          <a href="./user_list.html" class="nav-items"
            ><i class="bi bi-person"></i>
            <p>User List</p>
            <div
              class="tooltip"
              role="tooltip"
              style="top: 370px"
              data-popper-placement="right"
            >
              User List
              <div class="arrow" data-popper-arrow></div>
            </div>
          </a>
          <a href="#" class="nav-items active"
            ><i class="bi bi-hdd-stack-fill"></i>
            <p>Book Request List</p>
            <div
              class="tooltip"
              role="tooltip"
              style="top: 430px"
              data-popper-placement="right"
            >
              Book Request List
              <div class="arrow" data-popper-arrow></div>
            </div>
          </a>
        </div>
      </div>
      <div class="side-footer">
        <div class="dark-toggle">
          <a href="#" onclick="darkMode()" class="nav-items"
            ><i class="bi bi-moon-stars-fill dark-light"></i>
            <p class="da-li-text">Dark mode</p>
            <div
              class="tooltip"
              role="tooltip"
              style="bottom: 115px; top: unset"
              data-popper-placement="right"
            >
              Theme
              <div class="arrow" data-popper-arrow></div>
            </div>
          </a>
          <a href="#" class="nav-items" id="sign-out"
            ><i class="bi bi-box-arrow-left"></i>
            <p>Log Out</p>
            <div
              class="tooltip"
              role="tooltip"
              style="bottom: 55px; top: unset"
              data-popper-placement="right"
            >
              Log-Out
              <div class="arrow" data-popper-arrow></div>
            </div>
          </a>
        </div>
      </div>
    </nav>
    <section class="main-container">
      <main class="user-list-container">
        <h3>User List</h3>
        <div class="user-list-table-wrapper">
          <div class="user-list-table-body"></div>
        </div>
      </main>
    </section>

    <script type="module">
      import { Grid, h } from "https://unpkg.com/gridjs?module";
      const allReq = await getData("BookRequests");
      const userList = await getData("Users");

      const reqData = allReq.map((req, index) => {
        const user = userList.find((user) => user.id === req.user_id);
        return [
          index + 1,
          user["name"],
          req["book_name"],
          req["author_name"],
          req["description"],
          moment(req["log"]).format("MMMM Do YYYY, h:mm a"),
          req["price"] || "-",
          req["id"]
        ];
      });

      const tableGrid = new Grid({
        columns: [
          "S.No",
          "Requester Name",
          "Book Name",
          "Author Name",
          "Description",
          "Requested On",
          {
            name: "Price",
            formatter: (_, row) => `â‚¹ ${row.cells[6].data} INR`,
          },
          {
            name: "Actions",
            formatter: (cell, row) => {
              return h(
                "button",
                {
                  style:
                    "margin-top: 0 ;width: fit-content;height: fit-content;padding:5px;border-radius:5px",
                  className: "submit ",
                  onClick: () =>
                  deleteData(`BookRequests/${row.cells[7].data}`)
                  .then(()=>{
                    alert("BookRequest Marked as Bought!");
                    location.reload();
                  }),
                },
                "Mark Done"
              );
            },
          },
        ],
        data: reqData,
        pagination: {
          limit: 5,
        },
        fixedHeader: true,
        search: true,
        autoWidth: true,
      }).render(document.querySelector(".user-list-table-body"));
      setLoader(false);
    </script>
  </body>
</html>
